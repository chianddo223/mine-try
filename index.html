<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Que pasa</title>
    <style>
        @font-face {
            font-family: 'CookieRun-Regular';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/CookieRun-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        table {
            border-collapse: collapse;
            background: #888;
        }

        td {
            font-family: 'CookieRun-Regular';
            font-size: 5.8vw;
            border: 1vw solid #bbb;
            text-align: center;
            line-height: 20px;
            width: 8vw;
            height: 8vw;
            background: #888;
        }

        td#mine {
            color: #888;
            background: #888;
        }
    </style>
</head>

<body>
<table id="table">
    <tbody>
    </tbody>
</table>
<form id="form">
    <input placeholder="Í∞ÄÎ°ú Ï§Ñ" id="row" size="5" />
    <input placeholder="ÏÑ∏Î°ú Ï§Ñ" id="cell" size="5" />
    <input placeholder="ÏßÄÎ¢∞" id="mine" size="5" />
    <button>Í≤åÏûÑÏãúÏûë</button>
</form>
<script>
const $tbody = document.querySelector('#table tbody');
const $inputRow = document.querySelector('#row');
const $inputCol = document.querySelector('#cell');
const $inputMine = document.querySelector('#mine');
const $btn = document.querySelector('button');
const rows = [];
const randomArray = [];
const mineArray = [];
let flattedArray = rows.flat();
let copyFlatted = flattedArray.concat();
let numRows = 0;
let numClos = 0;
let numMine = 0;
let arrayWidth = 0;
$btn.addEventListener('click', startGame);
function startGame() {
    event.preventDefault();
    numRows = $inputRow.value; // ÏÑ∏Î°ú Í∞í 
    numClos = $inputCol.value; // Í∞ÄÎ°ú Í∞í
    numMine = parseInt($inputMine.value);
    arrayWidth = numRows * numClos;
    for (let i = 0; i < numRows; i++) { // 2Ï∞®ÏõêÎ∞∞Ïó¥ ÎßåÎì§Í∏∞.
        const $tr = document.createElement('tr');
        const cells = [];
        for (let j = 0; j < numClos; j++) { // Í∞ÅÍ∞ÅÏùò tdÍ∞Ä ÏÉùÏÑ±ÎêòÎ©¥ÏÑú ÌäπÏÑ±Î∂ÄÏó¨Î∞õÏùå.
            const $td = document.createElement('td');
            $td.addEventListener('click', onClick);
            $td.addEventListener('contextmenu', fillRed);
            $td.classList.add(i * 10 + j);
            cells.push($td);
            $tr.append($td);
        }
        rows.push(cells);
        $tbody.append($tr);
    };
    flattedArray = rows.flat();
    copyFlatted = flattedArray.concat();
    shuffleMine();
};
function shuffleMine() {
    // console.log(flattedArray)
    for (let i = 0; i < numMine; i++) { // ÎûúÎç§ ÏßÄÎ¢∞ Î∞∞Ïó¥ÎßåÎì§Í∏∞.
        const randomIndex = flattedArray.splice(Math.floor(Math.random() * flattedArray.length), 1);
        randomArray.push(randomIndex);
    }
    const flattedRandom = randomArray.flat();
    for (let j = 0; j < numMine; j++) { // ÏßÄÎ¢∞ Î∞∞Ïó¥ ÎßåÎì§Í≥†, id, ÌÖçÏä§Ìä∏ Îã¨ÏïÑÏ£ºÍ∏∞.
        mineArray.push(flattedRandom[j]);
        mineArray[j].id = "mine";
    }
}
function onClick() { // Í≥µÍ∞ÑÏùÑ ÌÅ¥Î¶≠ÌñàÏùÑ Îïå.
    if (this.id === 'mine') { // ÏßÄÎ¢∞Ïùº Îïå 
        this.style.background = 'black';
        this.textContent = 'üí•';
    } else { // ÏßÄÎ¢∞Í∞Ä ÏïÑÎãê Îïå Ï£ºÎ≥Ä ÏßÄÎ¢∞Í∞ØÏàò Ï≤¥ÌÅ¨.
        checkAround(this);
    };
    if( this.style.background === 'white'){
    const whiteBlock = copyFlatted.filter((item) => item.style.background === 'white');
    for( let i = 0; i < whiteBlock.length; i++){
        checkAround(whiteBlock[i]);
    }
}
};
function fillRed() {
    event.preventDefault();
    if (this.textContent === 'üö©') {
        this.style.background = '#888';
        this.textContent = '';
    } else {
         this.style.background = '#888';
        this.textContent = 'üö©';
   };
};

function checkAround( clickedBlock ){ // Ï£ºÎ≥ÄÏóê ÏßÄÎ¢∞Í∞ØÏàò Ï≤¥ÌÅ¨ÌïòÍ≥† ÌëúÏãúÌï¥Ï§å.
        const onClickClass = clickedBlock.className;        
        const checkList = [];
        const classOfCheckList = [onClickClass - 11, onClickClass - 10, onClickClass - 9,
        onClickClass - 1, parseInt(onClickClass) + 1,
        parseInt(onClickClass) + 9, parseInt(onClickClass) + 10, parseInt(onClickClass) + 11];
        const filteredClass1 = classOfCheckList.filter( item => -1 < item && item< numRows * numClos );
        for (let i = 0; i < filteredClass1.length; i++) { // Ï°¥Ïû¨ÌïòÎäî Ïπ∏Îßå ÌïÑÌÑ∞ÎßÅ. 
            checkList.push(copyFlatted[filteredClass1[i]]);
        };
        console.log(checkList);
        const countMine = checkList.filter(item => item.id === "mine").length;
        clickedBlock.textContent = countMine;
        clickedBlock.style.background = 'white';
        if (countMine === 0) {
            clickedBlock.textContent = ''; 
            let aroundCheckList = [];
            for (let j = 0; j < checkList.length; j++) { // ÏÑ†ÌÉùÌïú Ïπ∏Ïùò Ï£ºÎ≥Ä Ïπ∏Ïùò, Ï£ºÎ≥Ä ÏßÄÎ¢∞ Í∞ØÏàòÎ•º ÌôïÏù∏Ìï®. Î∞òÎ≥µÎ¨∏Ïù¥ ÏãúÌñâÎê† Îïå ÎßàÎã§ ÏßÄÎ¢∞Ïùò ÏàòÍ∞Ä ÏÉàÎ°≠Í≤å Í∞±Ïã†ÎêòÍ≥†, Ï£ºÎ≥Ä ÏßÄÎ¢∞ ÏàòÍ∞Ä 0Ïù∏ Ïπ∏ÏùÑ Îπà Ïπ∏ÏúºÎ°ú ÎßåÎì§Ïñ¥ Ï§å.
                const aroundClass = checkList[j].className;
                const aroundClassOfCheckList = [aroundClass - 11, aroundClass - 10, aroundClass - 9,
                aroundClass - 1, parseInt(aroundClass) + 1,
                parseInt(aroundClass) + 9, parseInt(aroundClass) + 10, parseInt(aroundClass) + 11];
                console.log(aroundClassOfCheckList)
                const filteredClass2 = aroundClassOfCheckList.filter( item => -1 < item && item < numRows * numClos);
                console.log(numRows * numClos)
                console.log(filteredClass2)
                for (let k = 0; k < filteredClass2.length; k++) { // Ï°¥Ïû¨ÌïòÎäî Ïπ∏Îßå ÌïÑÌÑ∞ÎßÅ. 
                    aroundCheckList.push(copyFlatted[filteredClass2[k]]);
                }; 
                console.log(aroundCheckList)
                const aroundCountMine = aroundCheckList.filter(item => item.id === "mine").length;
                copyFlatted[filteredClass1[j]].textContent = aroundCountMine;
                if( aroundCountMine === 0 ){ // Ï£ºÎ≥ÄÏóê ÏßÄÎ¢∞Í∞Ä ÏóÜÎäî ÎïÖ Î∞úÍ≤¨ Ïãú.
                    copyFlatted[filteredClass1[j]].textContent = '';
                }
                copyFlatted[filteredClass1[j]].style.background = 'white';
                aroundCheckList = [];
            };

}
}

function secondCheckAround( secondCheckList ){
    console.log( secondCheckList );
}
console.log(rows);
</script>
</body>

</html>
